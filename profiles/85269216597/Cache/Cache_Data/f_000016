{"version":3,"file":"725.12c1ba16de4c3fac7523.chunk.js","mappings":"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","sources":["webpack://tweb/./src/helpers/array/forEachReverse.ts","webpack://tweb/./src/helpers/getFileNameForUpload.ts","webpack://tweb/./src/lib/appManagers/utils/docs/getDocumentDownloadOptions.ts","webpack://tweb/./src/lib/appManagers/utils/docs/getDocumentInput.ts","webpack://tweb/./src/lib/appManagers/utils/download/getDownloadFileNameFromOptions.ts","webpack://tweb/./src/lib/appManagers/utils/download/getDownloadMediaDetails.ts","webpack://tweb/./src/lib/appManagers/utils/webDocs/getWebDocumentDownloadOptions.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/generateMessageId.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/getServerMessageId.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/clearMessageId.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/index.ts","webpack://tweb/./src/lib/appManagers/utils/photos/getPhotoDownloadOptions.ts","webpack://tweb/./src/lib/appManagers/utils/webDocs/isWebDocument.ts","webpack://tweb/./src/lib/richTextProcessor/encodeSpoiler.ts","webpack://tweb/./src/lib/richTextProcessor/spoiler.ts","webpack://tweb/./src/config/tld.ts","webpack://tweb/./src/lib/richTextProcessor/checkBrackets.ts","webpack://tweb/./src/lib/richTextProcessor/getEmojiUnified.ts","webpack://tweb/./src/lib/richTextProcessor/parseEntities.ts"],"sourcesContent":["export default function forEachReverse<T>(array: Array<T>, callback: (value: T, index?: number, array?: Array<T>) => void) {\n  for(let length = array.length, i = length - 1; i >= 0; --i) {\n    callback(array[i], i, array);\n  }\n};\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport tabId from \"../config/tabId\";\r\n\r\nlet uploadId = 0;\r\nexport default function getFileNameForUpload(file: File | Blob) {\r\n  let fileName: string;\r\n  const mimeType = file?.type;\r\n  if(mimeType) { // the same like apiFileName in appMessagesManager for upload!\r\n    const ext = `${tabId}_${uploadId++}.mimeType.split('/')[1]`;\r\n\r\n    if(['image/jpeg', 'image/png', 'image/bmp'].indexOf(mimeType) >= 0) {\r\n      fileName = 'photo' + ext;\r\n    } else if(mimeType.indexOf('audio/') === 0 || ['video/ogg'].indexOf(mimeType) >= 0) {\r\n      fileName = 'audio' + ext;\r\n    } else if(mimeType.indexOf('video/') === 0) {\r\n      fileName = 'video' + ext;\r\n    } else {\r\n      fileName = 'document' + ext;\r\n    }\r\n  } else {\r\n    fileName = `upload-${tabId}_${uploadId++}`;\r\n  }\r\n\r\n  return fileName;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type { Document, PhotoSize } from \"../../../../layer\";\r\nimport type { DownloadOptions } from \"../../../mtproto/apiFileManager\";\r\nimport getDocumentInput from \"./getDocumentInput\";\r\n\r\nexport default function getDocumentDownloadOptions(doc: Document.document, thumb?: PhotoSize.photoSize, queueId?: number, onlyCache?: boolean): DownloadOptions {\r\n  const inputFileLocation = getDocumentInput(doc, thumb?.type);\r\n\r\n  let mimeType: string;\r\n  if(thumb) {\r\n    mimeType = doc.sticker ? 'image/webp' : 'image/jpeg'/* doc.mime_type */;\r\n  } else {\r\n    mimeType = doc.mime_type || 'application/octet-stream';\r\n  }\r\n\r\n  return {\r\n    dcId: doc.dc_id, \r\n    location: inputFileLocation, \r\n    size: thumb ? thumb.size : doc.size, \r\n    mimeType,\r\n    fileName: doc.file_name,\r\n    queueId,\r\n    onlyCache\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { Document, InputFileLocation } from \"../../../../layer\";\r\n\r\nexport default function getInput(doc: Document.document, thumbSize?: string): InputFileLocation.inputDocumentFileLocation {\r\n  return {\r\n    _: 'inputDocumentFileLocation',\r\n    id: doc.id,\r\n    access_hash: doc.access_hash,\r\n    file_reference: doc.file_reference,\r\n    thumb_size: thumbSize\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { getFileNameByLocation } from \"../../../../helpers/fileName\";\r\nimport { DownloadOptions } from \"../../../mtproto/apiFileManager\";\r\n\r\nexport default function getDownloadFileNameFromOptions(options: DownloadOptions) {\r\n  return getFileNameByLocation(options.location, {fileName: options.fileName});\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type { DownloadMediaOptions, DownloadOptions } from \"../../../mtproto/apiFileManager\";\r\nimport getDocumentDownloadOptions from \"../docs/getDocumentDownloadOptions\";\r\nimport getPhotoDownloadOptions from \"../photos/getPhotoDownloadOptions\";\r\nimport getWebDocumentDownloadOptions from \"../webDocs/getWebDocumentDownloadOptions\";\r\nimport isWebDocument from \"../webDocs/isWebDocument\";\r\nimport getDownloadFileNameFromOptions from \"./getDownloadFileNameFromOptions\";\r\n\r\nexport default function getDownloadMediaDetails(options: DownloadMediaOptions) {\r\n  const {media, thumb, queueId, onlyCache} = options;\r\n  \r\n  let downloadOptions: DownloadOptions;\r\n  if(media._ === 'document') downloadOptions = getDocumentDownloadOptions(media, thumb as any, queueId, onlyCache);\r\n  else if(media._ === 'photo') downloadOptions = getPhotoDownloadOptions(media, thumb, queueId, onlyCache);\r\n  else if(isWebDocument(media)) downloadOptions = getWebDocumentDownloadOptions(media);\r\n\r\n  const fileName = getDownloadFileNameFromOptions(downloadOptions);\r\n  return {fileName, downloadOptions};\r\n}\r\n","import { WebDocument } from \"../../../../layer\";\nimport { DownloadOptions } from \"../../../mtproto/apiFileManager\";\n\nexport default function getWebDocumentDownloadOptions(webDocument: WebDocument): DownloadOptions {\n  return {\n    dcId: 4,\n    location: {\n      _: 'inputWebFileLocation',\n      access_hash: (webDocument as WebDocument.webDocument).access_hash,\n      url: webDocument.url\n    },\n    size: webDocument.size,\n    mimeType: webDocument.mime_type\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport { MESSAGE_ID_OFFSET, MESSAGE_ID_INCREMENT } from \".\";\n\nexport default function generateMessageId(messageId: number) {\n  const q = MESSAGE_ID_OFFSET;\n  if(messageId >= q) {\n    return messageId;\n  }\n\n  return q + (messageId * MESSAGE_ID_INCREMENT);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport clearMessageId from \"./clearMessageId\";\n\n/**\n * * will ignore outgoing offset\n */\nexport default function getServerMessageId(messageId: number) {\n  return clearMessageId(messageId, true);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport { MESSAGE_ID_OFFSET, MESSAGE_ID_INCREMENT } from \".\";\n\nexport default function clearMessageId(messageId: number, toServer?: boolean) {\n  const q = MESSAGE_ID_OFFSET;\n  if(messageId < q) { // id 0 -> mid 0xFFFFFFFF, so 0xFFFFFFFF must convert to 0\n    return messageId;\n  }\n\n  const l = MESSAGE_ID_INCREMENT - 1;\n  const used = messageId & l;\n  if(used !== l) {\n    messageId -= used + 1;\n  }\n\n  return toServer ? (messageId - q) / MESSAGE_ID_INCREMENT : messageId;\n}\n","export const MESSAGE_ID_INCREMENT = 0x10000;\nexport const MESSAGE_ID_OFFSET = 0xFFFFFFFF;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type { PhotoSize, InputFileLocation } from \"../../../../layer\";\nimport type { DownloadOptions } from \"../../../mtproto/apiFileManager\";\nimport type { MyDocument } from \"../../appDocsManager\";\nimport type { MyPhoto } from \"../../appPhotosManager\";\n\nexport default function getPhotoDownloadOptions(photo: MyPhoto | MyDocument, photoSize: PhotoSize, queueId?: number, onlyCache?: boolean): DownloadOptions {\n  const isDocument = photo._ === 'document';\n\n  if(!photoSize || photoSize._ === 'photoSizeEmpty') {\n    //console.error('no photoSize by photo:', photo);\n    throw new Error('photoSizeEmpty!');\n  }\n  \n  // maybe it's a thumb\n  const isPhoto = (photoSize._ === 'photoSize' || photoSize._ === 'photoSizeProgressive') && photo.access_hash && photo.file_reference;\n  const location: InputFileLocation.inputPhotoFileLocation | InputFileLocation.inputDocumentFileLocation = {\n    _: isDocument ? 'inputDocumentFileLocation' : 'inputPhotoFileLocation',\n    id: photo.id,\n    access_hash: photo.access_hash,\n    file_reference: photo.file_reference,\n    thumb_size: photoSize.type\n  };\n\n  return {\n    dcId: photo.dc_id, \n    location, \n    size: isPhoto ? (photoSize as PhotoSize.photoSize).size : undefined, \n    queueId, \n    onlyCache\n  };\n}\n","import { WebDocument } from \"../../../../layer\";\n\nexport default function isWebDocument(webDocument: any): webDocument is WebDocument {\n  return !!(webDocument && (webDocument._ === 'webDocument' || webDocument._ === 'webDocumentNoProxy'));\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport { MessageEntity } from \"../../layer\";\nimport spoiler from \"./spoiler\";\n\nexport default function encodeSpoiler(text: string, entity: MessageEntity.messageEntitySpoiler) {\n  const before = text.slice(0, entity.offset);\n  const spoilerBefore = text.slice(entity.offset, entity.offset + entity.length);\n  const spoilerAfter = spoiler(spoilerBefore)/*  '▚'.repeat(entity.length) */;\n  const after = text.slice(entity.offset + entity.length);\n  text = before + spoilerAfter + after;\n  return {text, entityText: spoilerAfter};\n};\n","export default function spoiler(text: string): string {\n  const chars = '⠁⠂⠄⠈⠐⠠⡀⢀⠃⠅⠆⠉⠊⠌⠑⠒⠔⠘⠡⠢⠤⠨⠰⡁⡂⡄⡈⡐⡠⢁⢂⢄⢈⢐⢠⣀⠇⠋⠍⠎⠓⠕⠖⠙⠚⠜⠣⠥⠦⠩⠪⠬⠱⠲⠴⠸⡃⡅⡆⡉⡊⡌⡑⡒⡔⡘⡡⡢⡤⡨⡰⢃⢅⢆⢉⢊⢌⢑⢒⢔⢘⢡⢢⢤⢨⢰⣁⣂⣄⣈⣐⣠⠏⠗⠛⠝⠞⠧⠫⠭⠮⠳⠵⠶⠹⠺⠼⡇⡋⡍⡎⡓⡕⡖⡙⡚⡜⡣⡥⡦⡩⡪⡬⡱⡲⡴⡸⢇⢋⢍⢎⢓⢕⢖⢙⢚⢜⢣⢥⢦⢩⢪⢬⢱⢲⢴⢸⣃⣅⣆⣉⣊⣌⣑⣒⣔⣘⣡⣢⣤⣨⣰⠟⠯⠷⠻⠽⠾⡏⡗⡛⡝⡞⡧⡫⡭⡮⡳⡵⡶⡹⡺⡼⢏⢗⢛⢝⢞⢧⢫⢭⢮⢳⢵⢶⢹⢺⢼⣇⣋⣍⣎⣓⣕⣖⣙⣚⣜⣣⣥⣦⣩⣪⣬⣱⣲⣴⣸⠿⡟⡯⡷⡻⡽⡾⢟⢯⢷⢻⢽⢾⣏⣗⣛⣝⣞⣧⣫⣭⣮⣳⣵⣶⣹⣺⣼⡿⢿⣟⣯⣷⣻⣽⣾⣿';\n  const charsLength = chars.length;\n  \n  const out: string[] = [];\n  for(let i = 0; i < text.length; ++i) {\n    let char = text.charCodeAt(i);\n    out.push(chars[char % charsLength]);\n  }\n\n  return out.join('');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n * \n * Originally from:\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\n// From https://github.com/stephenmathieson/node-tlds/blob/master/index.js\nconst TLD = ['abogado', 'ac', 'academy', 'accountants', 'active', 'actor', 'ad', 'adult', 'ae', 'aero', 'af', 'ag', 'agency', 'ai', 'airforce', 'al', 'allfinanz', 'alsace', 'am', 'amsterdam', 'an', 'android', 'ao', 'apartments', 'aq', 'aquarelle', 'ar', 'archi', 'army', 'arpa', 'as', 'asia', 'associates', 'at', 'attorney', 'au', 'auction', 'audio', 'autos', 'aw', 'ax', 'axa', 'az', 'ba', 'band', 'bank', 'bar', 'barclaycard', 'barclays', 'bargains', 'bayern', 'bb', 'bd', 'be', 'beer', 'berlin', 'best', 'bf', 'bg', 'bh', 'bi', 'bid', 'bike', 'bingo', 'bio', 'biz', 'bj', 'black', 'blackfriday', 'bloomberg', 'blue', 'bm', 'bmw', 'bn', 'bnpparibas', 'bo', 'boo', 'boutique', 'br', 'brussels', 'bs', 'bt', 'budapest', 'build', 'builders', 'business', 'buzz', 'bv', 'bw', 'by', 'bz', 'bzh', 'ca', 'cab', 'cal', 'camera', 'camp', 'cancerresearch', 'canon', 'capetown', 'capital', 'caravan', 'cards', 'care', 'career', 'careers', 'cartier', 'casa', 'cash', 'cat', 'catering', 'cc', 'cd', 'center', 'ceo', 'cern', 'cf', 'cg', 'ch', 'channel', 'chat', 'cheap', 'christmas', 'chrome', 'church', 'ci', 'citic', 'city', 'ck', 'cl', 'claims', 'cleaning', 'click', 'clinic', 'clothing', 'club', 'cm', 'cn', 'co', 'coach', 'codes', 'coffee', 'college', 'cologne', 'com', 'community', 'company', 'computer', 'condos', 'construction', 'consulting', 'contractors', 'cooking', 'cool', 'coop', 'country', 'cr', 'credit', 'creditcard', 'cricket', 'crs', 'cruises', 'cu', 'cuisinella', 'cv', 'cw', 'cx', 'cy', 'cymru', 'cz', 'dabur', 'dad', 'dance', 'dating', 'day', 'dclk', 'de', 'deals', 'degree', 'delivery', 'democrat', 'dental', 'dentist', 'desi', 'design', 'dev', 'diamonds', 'diet', 'digital', 'direct', 'directory', 'discount', 'dj', 'dk', 'dm', 'dnp', 'do', 'docs', 'domains', 'doosan', 'durban', 'dvag', 'dz', 'eat', 'ec', 'edu', 'education', 'ee', 'eg', 'email', 'emerck', 'energy', 'engineer', 'engineering', 'enterprises', 'equipment', 'er', 'es', 'esq', 'estate', 'et', 'eu', 'eurovision', 'eus', 'events', 'everbank', 'exchange', 'expert', 'exposed', 'fail', 'farm', 'fashion', 'feedback', 'fi', 'finance', 'financial', 'firmdale', 'fish', 'fishing', 'fit', 'fitness', 'fj', 'fk', 'flights', 'florist', 'flowers', 'flsmidth', 'fly', 'fm', 'fo', 'foo', 'forsale', 'foundation', 'fr', 'frl', 'frogans', 'fund', 'furniture', 'futbol', 'ga', 'gal', 'gallery', 'garden', 'gb', 'gbiz', 'gd', 'ge', 'gent', 'gf', 'gg', 'ggee', 'gh', 'gi', 'gift', 'gifts', 'gives', 'gl', 'glass', 'gle', 'global', 'globo', 'gm', 'gmail', 'gmo', 'gmx', 'gn', 'goog', 'google', 'gop', 'gov', 'gp', 'gq', 'gr', 'graphics', 'gratis', 'green', 'gripe', 'gs', 'gt', 'gu', 'guide', 'guitars', 'guru', 'gw', 'gy', 'hamburg', 'hangout', 'haus', 'healthcare', 'help', 'here', 'hermes', 'hiphop', 'hiv', 'hk', 'hm', 'hn', 'holdings', 'holiday', 'homes', 'horse', 'host', 'hosting', 'house', 'how', 'hr', 'ht', 'hu', 'ibm', 'id', 'ie', 'ifm', 'il', 'im', 'immo', 'immobilien', 'in', 'industries', 'info', 'ing', 'ink', 'institute', 'insure', 'int', 'international', 'investments', 'io', 'iq', 'ir', 'irish', 'is', 'it', 'iwc', 'jcb', 'je', 'jetzt', 'jm', 'jo', 'jobs', 'joburg', 'jp', 'juegos', 'kaufen', 'kddi', 'ke', 'kg', 'kh', 'ki', 'kim', 'kitchen', 'kiwi', 'km', 'kn', 'koeln', 'kp', 'kr', 'krd', 'kred', 'kw', 'ky', 'kyoto', 'kz', 'la', 'lacaixa', 'land', 'lat', 'latrobe', 'lawyer', 'lb', 'lc', 'lds', 'lease', 'legal', 'lgbt', 'li', 'lidl', 'life', 'lighting', 'limited', 'limo', 'link', 'lk', 'loans', 'london', 'lotte', 'lotto', 'lr', 'ls', 'lt', 'ltda', 'lu', 'luxe', 'luxury', 'lv', 'ly', 'ma', 'madrid', 'maison', 'management', 'mango', 'market', 'marketing', 'marriott', 'mc', 'md', 'me', 'media', 'meet', 'melbourne', 'meme', 'memorial', 'menu', 'mg', 'mh', 'miami', 'mil', 'mini', 'mk', 'ml', 'mm', 'mn', 'mo', 'mobi', 'moda', 'moe', 'monash', 'money', 'mormon', 'mortgage', 'moscow', 'motorcycles', 'mov', 'mp', 'mq', 'mr', 'ms', 'mt', 'mu', 'museum', 'mv', 'mw', 'mx', 'my', 'mz', 'na', 'nagoya', 'name', 'navy', 'nc', 'ne', 'net', 'network', 'neustar', 'new', 'nexus', 'nf', 'ng', 'ngo', 'nhk', 'ni', 'nico', 'ninja', 'nl', 'no', 'np', 'nr', 'nra', 'nrw', 'ntt', 'nu', 'nyc', 'nz', 'okinawa', 'om', 'one', 'ong', 'onl', 'ooo', 'org', 'organic', 'osaka', 'otsuka', 'ovh', 'pa', 'paris', 'partners', 'parts', 'party', 'pe', 'pf', 'pg', 'ph', 'pharmacy', 'photo', 'photography', 'photos', 'physio', 'pics', 'pictures', 'pink', 'pizza', 'pk', 'pl', 'place', 'plumbing', 'pm', 'pn', 'pohl', 'poker', 'porn', 'post', 'pr', 'praxi', 'press', 'pro', 'prod', 'productions', 'prof', 'properties', 'property', 'ps', 'pt', 'pub', 'pw', 'py', 'qa', 'qpon', 'quebec', 're', 'realtor', 'recipes', 'red', 'rehab', 'reise', 'reisen', 'reit', 'ren', 'rentals', 'repair', 'report', 'republican', 'rest', 'restaurant', 'reviews', 'rich', 'rio', 'rip', 'ro', 'rocks', 'rodeo', 'rs', 'rsvp', 'ru', 'ruhr', 'rw', 'ryukyu', 'sa', 'saarland', 'sale', 'samsung', 'sarl', 'saxo', 'sb', 'sc', 'sca', 'scb', 'schmidt', 'schule', 'schwarz', 'science', 'scot', 'sd', 'se', 'services', 'sew', 'sexy', 'sg', 'sh', 'shiksha', 'shoes', 'shriram', 'si', 'singles', 'sj', 'sk', 'sky', 'sl', 'sm', 'sn', 'so', 'social', 'software', 'sohu', 'solar', 'solutions', 'soy', 'space', 'spiegel', 'sr', 'st', 'style', 'su', 'supplies', 'supply', 'support', 'surf', 'surgery', 'suzuki', 'sv', 'sx', 'sy', 'sydney', 'systems', 'sz', 'taipei', 'tatar', 'tattoo', 'tax', 'tc', 'td', 'technology', 'tel', 'temasek', 'tennis', 'tf', 'tg', 'th', 'tienda', 'tips', 'tires', 'tirol', 'tj', 'tk', 'tl', 'tm', 'tn', 'to', 'today', 'tokyo', 'tools', 'top', 'toshiba', 'town', 'toys', 'tp', 'tr', 'trade', 'training', 'travel', 'trust', 'tt', 'tui', 'tv', 'tw', 'tz', 'ua', 'ug', 'uk', 'university', 'uno', 'uol', 'us', 'uy', 'uz', 'va', 'vacations', 'vc', 've', 'vegas', 'ventures', 'versicherung', 'vet', 'vg', 'vi', 'viajes', 'video', 'villas', 'vision', 'vlaanderen', 'vn', 'vodka', 'vote', 'voting', 'voto', 'voyage', 'vu', 'wales', 'wang', 'watch', 'webcam', 'website', 'wed', 'wedding', 'wf', 'whoswho', 'wien', 'wiki', 'williamhill', 'wme', 'work', 'works', 'world', 'ws', 'wtc', 'wtf', '佛山', '集团', '在线', '한국', 'ভারত', '八卦', 'موقع', '公益', '公司', '移动', '我爱你', 'москва', 'қаз', 'онлайн', 'сайт', 'срб', '淡马锡', 'орг', '삼성', 'சிங்கப்பூர்', '商标', '商店', '商城', 'дети', 'мкд', '中文网', '中信', '中国', '中國', '谷歌', 'భారత్', 'ලංකා', 'ભારત', 'भारत', '网店', 'संगठन', '网络', 'укр', '香港', '台湾', '台灣', '手机', 'мон', 'الجزائر', 'عمان', 'ایران', 'امارات', 'بازار', 'الاردن', 'بھارت', 'المغرب', 'السعودية', 'مليسيا', 'شبكة', 'გე', '机构', '组织机构', 'ไทย', 'سورية', 'рус', 'рф', 'تونس', 'みんな', 'グーグル', '世界', 'ਭਾਰਤ', '网址', '游戏', 'vermögensberater', 'vermögensberatung', '企业', 'مصر', 'قطر', '广东', 'இலங்கை', 'இந்தியா', '新加坡', 'فلسطين', '政务', 'xxx', 'xyz', 'yachts', 'yandex', 'ye', 'yoga', 'yokohama', 'youtube', 'yt', 'za', 'zip', 'zm', 'zone', 'zuerich', 'zw'];\n\nexport default TLD;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n * \n * Originally from:\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\nexport default function checkBrackets(url: string) {\n  var urlLength = url.length;\n  var urlOpenBrackets = url.split('(').length - 1;\n  var urlCloseBrackets = url.split(')').length - 1;\n  while(urlCloseBrackets > urlOpenBrackets &&\n    url.charAt(urlLength - 1) === ')') {\n    url = url.substr(0, urlLength - 1)\n    urlCloseBrackets--;\n    urlLength--;\n  }\n  if(urlOpenBrackets > urlCloseBrackets) {\n    url = url.replace(/\\)+$/, '');\n  }\n  return url;\n}\n","import Emoji from \"../../config/emoji\";\nimport { encodeEmoji } from \"../../vendor/emoji\";\n\nexport default function getEmojiUnified(emojiCode: string) {\n  let unified = encodeEmoji(emojiCode).replace(/-?fe0f/g, '');\n\n  /* if(unified === '1f441-200d-1f5e8') {\n    //unified = '1f441-fe0f-200d-1f5e8-fe0f';\n    unified = '1f441-fe0f-200d-1f5e8';\n  } */\n\n  if(!Emoji.hasOwnProperty(unified) \n    // && !emojiData.hasOwnProperty(unified.replace(/-?fe0f$/, ''))\n  ) {\n    //console.error('lol', unified);\n    return;\n  }\n\n  return unified;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n * \n * Originally from:\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\nimport { EMAIL_REG_EXP, FULL_REG_EXP } from \".\";\nimport TLD from \"../../config/tld\";\nimport { MessageEntity } from \"../../layer\";\nimport checkBrackets from \"./checkBrackets\";\nimport getEmojiUnified from \"./getEmojiUnified\";\n\nexport default function parseEntities(text: string) {\n  let match: any;\n  let raw = text;\n  const entities: MessageEntity[] = [];\n  let matchIndex;\n  let rawOffset = 0;\n  // var start = tsNow()\n  FULL_REG_EXP.lastIndex = 0;\n  while((match = raw.match(FULL_REG_EXP))) {\n    matchIndex = rawOffset + match.index;\n\n    //console.log('parseEntities match:', match);\n\n    if(match[3]) { // mentions\n      entities.push({\n        _: 'messageEntityMention',\n        offset: matchIndex + match[1].length,\n        length: match[2].length + match[3].length\n      });\n    } else if(match[4]) {\n      if(EMAIL_REG_EXP.test(match[4])) { // email\n        entities.push({\n          _: 'messageEntityEmail',\n          offset: matchIndex,\n          length: match[4].length\n        });\n      } else {\n        let url: string;\n        let protocol = match[5];\n        const tld = match[6];\n        // let excluded = '';\n        if(tld) { // URL\n          if(!protocol && (tld.substr(0, 4) === 'xn--' || TLD.indexOf(tld.toLowerCase()) !== -1)) {\n            protocol = 'http://';\n          }\n\n          if(protocol) {\n            const balanced = checkBrackets(match[4]);\n            if(balanced.length !== match[4].length) {\n              // excluded = match[4].substring(balanced.length);\n              match[4] = balanced;\n            }\n\n            url = (match[5] ? '' : protocol) + match[4];\n          }\n        } else { // IP address\n          url = (match[5] ? '' : 'http://') + match[4];\n        }\n\n        if(url) {\n          entities.push({\n            _: 'messageEntityUrl',\n            offset: matchIndex,\n            length: match[4].length\n          });\n        }\n      }\n    } else if(match[7]) { // New line\n      entities.push({\n        _: 'messageEntityLinebreak',\n        offset: matchIndex,\n        length: 1\n      });\n    } else if(match[8]) { // Emoji\n      //console.log('hit', match[8]);\n      const unified = getEmojiUnified(match[8]);\n      if(unified) {\n        entities.push({\n          _: 'messageEntityEmoji',\n          offset: matchIndex,\n          length: match[8].length,\n          unicode: unified\n        });\n      }\n    } else if(match[11]) { // Hashtag\n      entities.push({\n        _: 'messageEntityHashtag',\n        offset: matchIndex + (match[10] ? match[10].length : 0),\n        length: match[11].length\n      });\n    } else if(match[13]) { // Bot command\n      entities.push({\n        _: 'messageEntityBotCommand',\n        offset: matchIndex + (match[11] ? match[11].length : 0) + (match[12] ? match[12].length : 0),\n        length: 1 + match[13].length + (match[14] ? 1 + match[14].length : 0),\n        unsafe: true\n      });\n    }\n\n    raw = raw.substr(match.index + match[0].length);\n    rawOffset += match.index + match[0].length;\n  }\n\n  // if (entities.length) {\n  //   console.log('parse entities', text, entities.slice())\n  // }\n  return entities;\n}\n"],"names":["forEachReverse","array","callback","i","length","uploadId","getFileNameForUpload","file","fileName","mimeType","type","ext","indexOf","getDocumentDownloadOptions","doc","thumb","queueId","onlyCache","inputFileLocation","sticker","mime_type","dcId","dc_id","location","size","file_name","getInput","thumbSize","_","id","access_hash","file_reference","thumb_size","getDownloadFileNameFromOptions","options","getDownloadMediaDetails","media","downloadOptions","webDocument","getPhotoDownloadOptions","isWebDocument","url","generateMessageId","messageId","q","getServerMessageId","toServer","l","used","clearMessageId","MESSAGE_ID_INCREMENT","MESSAGE_ID_OFFSET","photo","photoSize","isDocument","Error","isPhoto","undefined","encodeSpoiler","text","entity","before","slice","offset","spoilerAfter","chars","charsLength","out","char","charCodeAt","push","join","spoiler","after","entityText","checkBrackets","urlLength","urlOpenBrackets","split","urlCloseBrackets","charAt","substr","replace","getEmojiUnified","emojiCode","unified","parseEntities","match","raw","entities","matchIndex","rawOffset","index","E","protocol","tld","toLowerCase","balanced","unicode","unsafe"],"sourceRoot":""}